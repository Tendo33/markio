# Markio API 测试文档

## 概述

本测试套件用于测试 Markio 文档解析服务的 API 功能和并发性能。测试覆盖所有支持的文档格式解析接口，包括功能测试和性能测试。

## 测试目标

- **API功能测试**: 验证所有解析接口的正确性和稳定性
- **并发性能测试**: 测试服务在高并发场景下的表现
- **负载测试**: 验证服务在不同负载下的性能
- **压力测试**: 测试服务的极限处理能力

## 环境要求

### 系统要求
- Python 3.11+
- 足够的磁盘空间用于测试文件
- 网络访问权限

### 依赖包
```bash
pytest>=7.0.0
pytest-asyncio>=0.21.0
httpx>=0.28.1
```

### 服务要求
- Markio 服务必须运行在 `http://0.0.0.0:8000`
- 服务必须包含所有解析器模块

## 测试文件结构

```
tests/
├── conftest.py                    # pytest配置和共享fixtures
├── test_all_parsers.py            # 所有解析接口的功能测试
├── test_concurrent.py             # 并发性能测试
├── README.md                      # 本说明文档
├── run_tests.py                   # 启动测试脚本
├── run_concurrent_tests.py        # 启动并发测试脚本
└── test_docs/                     # 测试文档目录
    ├── test_pdf1.pdf             # PDF测试文件
    ├── test_doc.doc              # DOC测试文件
    ├── test_docx.docx            # DOCX测试文件
    ├── test_ppt.ppt              # PPT测试文件
    ├── test_pptx.pptx            # PPTX测试文件
    ├── test_xlsx.xlsx            # XLSX测试文件
    ├── test_html.html            # HTML测试文件
    ├── test_epub.epub            # EPUB测试文件
    └── test_pdf2.pdf             # 额外PDF测试文件
```

## 支持的API接口

| 文件类型 | 接口路径 | 描述 |
|---------|---------|------|
| PDF | `/v1/parse_pdf_file` | PDF文档解析 |
| DOC | `/v1/parse_doc_file` | DOC文档解析 |
| DOCX | `/v1/parse_docx_file` | DOCX文档解析 |
| PPT | `/v1/parse_ppt_file` | PPT演示文稿解析 |
| PPTX | `/v1/parse_pptx_file` | PPTX演示文稿解析 |
| XLSX | `/v1/parse_xlsx_file` | XLSX表格解析 |
| HTML | `/v1/parse_html_file` | HTML文档解析 |
| EPUB | `/v1/parse_epub_file` | EPUB电子书解析 |
| 图片 | `/v1/parse_image_file` | 图片文档解析 |

## 运行测试

### 1. 运行所有API功能测试

```bash
# 使用pytest直接运行
pytest tests/test_all_parsers.py -v

# 使用测试脚本运行
python tests/run_tests.py
```

### 2. 运行并发性能测试

```bash
# 使用pytest直接运行
pytest tests/test_concurrent.py -v

# 使用测试脚本运行
python tests/run_concurrent_tests.py
```

### 3. 运行所有测试

```bash
# 运行整个测试套件
pytest tests/ -v

# 生成详细报告
pytest tests/ -v --tb=long --durations=10
```

## 测试类型说明

### 功能测试 (test_all_parsers.py)

- **健康检查**: 验证服务是否正常运行
- **文件解析**: 测试各种文件格式的解析功能
- **错误处理**: 测试无效文件、缺失文件等异常情况
- **大文件处理**: 测试大文件的处理能力

### 并发测试 (test_concurrent.py)

- **单接口并发**: 测试单个接口的并发处理能力
- **混合接口并发**: 测试不同接口的混合并发处理
- **负载测试**: 使用小文件进行高负载测试
- **压力测试**: 使用大文件进行压力测试

## 性能指标

### 响应时间
- **小文件**: 目标 < 20秒
- **中等文件**: 目标 < 30秒  
- **大文件**: 目标 < 60秒

### 成功率
- **功能测试**: 目标 100%
- **并发测试**: 目标 ≥ 80%
- **负载测试**: 目标 ≥ 70%
- **压力测试**: 目标 ≥ 60%

### 并发能力
- **单接口**: 支持5个并发用户
- **混合接口**: 支持5个不同类型的并发请求
- **负载测试**: 支持10个并发用户
- **压力测试**: 支持3个大文件并发处理

## 测试结果解读

### 成功标准
- 所有功能测试通过
- 并发测试成功率达标
- 响应时间在预期范围内
- 无系统崩溃或严重错误

### 失败分析
- 检查服务是否正常运行
- 验证测试文件是否存在
- 检查网络连接和防火墙设置
- 查看服务日志获取详细错误信息

## 常见问题

### 1. 服务连接失败
- 确认 Markio 服务正在运行
- 检查服务地址和端口配置
- 验证网络连接和防火墙设置

### 2. 测试文件缺失
- 确认 `test_docs/` 目录存在
- 检查测试文件是否完整
- 重新下载或生成测试文件

### 3. 测试超时
- 增加测试超时时间
- 检查服务性能是否下降
- 减少并发用户数量

### 4. 内存不足
- 减少并发测试规模
- 使用较小的测试文件
- 增加系统内存或优化服务配置

## 持续集成

### 自动化测试
- 支持 CI/CD 流水线集成
- 可配置的测试参数
- 自动生成测试报告

### 测试报告
- 详细的测试结果记录
- 性能指标统计
- 失败用例分析

## 维护和更新

### 定期更新
- 根据服务版本更新测试用例
- 添加新的文件格式支持
- 优化测试性能和稳定性

### 问题反馈
- 报告测试中发现的问题
- 提供详细的错误信息
- 协助问题排查和解决

## 联系信息

如有问题或建议，请联系开发团队或提交 Issue。
