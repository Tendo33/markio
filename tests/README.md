# Markio æµ‹è¯•å¥—ä»¶

## æ¦‚è¿°

è¿™æ˜¯Markioé¡¹ç›®çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼Œä½¿ç”¨çœŸå®çš„æ–‡æ¡£æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œç¡®ä¿æµ‹è¯•çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚

## ğŸ†• æ”¹è¿›å†…å®¹

### ä»Mockæ•°æ®åˆ°çœŸå®æ–‡ä»¶
- **ä¹‹å‰**: ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å’Œè™šæ‹Ÿæ–‡ä»¶è·¯å¾„
- **ç°åœ¨**: ä½¿ç”¨`tests/test_docs/`ç›®å½•ä¸­çš„çœŸå®æ–‡æ¡£æ–‡ä»¶
- **ä¼˜åŠ¿**: æ›´çœŸå®çš„æµ‹è¯•ç¯å¢ƒï¼Œæ›´å¥½çš„é”™è¯¯æ£€æµ‹ï¼Œæ›´å¯é çš„æ€§èƒ½æµ‹è¯•

### æµ‹è¯•æ–‡ä»¶ç±»å‹
æµ‹è¯•å¥—ä»¶æ”¯æŒä»¥ä¸‹çœŸå®æ–‡æ¡£æ ¼å¼ï¼š
- **PDF**: `test_pdf1.pdf` (9.8MB), `test_pdf2.pdf` (1.3MB), `test_pdf3.pdf` (43KB)
- **Word**: `test_doc.doc` (314KB), `test_docx.docx` (131KB)
- **Excel**: `test_xlsx.xlsx` (12KB)
- **PowerPoint**: `test_ppt.ppt` (7.7MB), `test_pptx.pptx` (4.7MB)
- **HTML**: `test_html.html` (5.6MB)
- **EPUB**: `test_epub.epub` (652KB)

## ğŸ“ æ¸…ç†åçš„æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ __init__.py                    # æµ‹è¯•åŒ…åˆå§‹åŒ–
â”œâ”€â”€ conftest.py                    # pytesté…ç½®å’Œæµ‹è¯•fixtures
â”œâ”€â”€ pytest.ini                     # pytesté…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md                      # æœ¬è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ run_tests.py                   # ğŸš€ ç»Ÿä¸€çš„æµ‹è¯•è¿è¡Œè„šæœ¬ï¼ˆæ”¯æŒå¤šç§æ¨¡å¼ï¼‰
â”œâ”€â”€ test_api_endpoints.py          # ğŸ“¡ APIç«¯ç‚¹æµ‹è¯•ï¼ˆå·²æ”¹è¿›ï¼‰
â”œâ”€â”€ test_integration.py            # ğŸ”— é›†æˆæµ‹è¯•ï¼ˆå·²æ”¹è¿›ï¼‰
â”œâ”€â”€ test_concurrency.py            # âš¡ å¹¶å‘æµ‹è¯•ï¼ˆå·²æ”¹è¿›ï¼‰
â”œâ”€â”€ test_utils.py                  # ğŸ› ï¸ å·¥å…·æµ‹è¯•ï¼ˆå·²æ”¹è¿›ï¼‰
â””â”€â”€ test_docs/                     # ğŸ“š æµ‹è¯•æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ test_pdf1.pdf             # å¤§PDFæ–‡ä»¶ (9.8MB)
    â”œâ”€â”€ test_pdf2.pdf             # ä¸­PDFæ–‡ä»¶ (1.3MB)
    â”œâ”€â”€ test_pdf3.pdf             # å°PDFæ–‡ä»¶ (43KB)
    â”œâ”€â”€ test_doc.doc              # Wordæ–‡æ¡£ (314KB)
    â”œâ”€â”€ test_docx.docx            # Wordæ–‡æ¡£ (131KB)
    â”œâ”€â”€ test_xlsx.xlsx            # Excelæ–‡ä»¶ (12KB)
    â”œâ”€â”€ test_ppt.ppt              # PowerPoint (7.7MB)
    â”œâ”€â”€ test_pptx.pptx            # PowerPoint (4.7MB)
    â”œâ”€â”€ test_html.html            # HTMLæ–‡ä»¶ (5.6MB)
    â””â”€â”€ test_epub.epub            # EPUBæ–‡ä»¶ (652KB)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒæ£€æŸ¥
```bash
cd tests
python run_tests.py --check
```

### 2. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
```bash
python run_tests.py --full
```

### 3. è¿è¡Œå¿«é€Ÿæ¼”ç¤º
```bash
python run_tests.py --demo
```

### 4. é»˜è®¤è¿è¡Œï¼ˆå®Œæ•´æµ‹è¯•å¥—ä»¶ï¼‰
```bash
python run_tests.py
```

### 5. æŸ¥çœ‹å¸®åŠ©
```bash
python run_tests.py --help
```

### 6. è¿è¡Œç‰¹å®šæµ‹è¯•ç±»å‹
```bash
# APIç«¯ç‚¹æµ‹è¯•
pytest test_api_endpoints.py -v -m real_files

# é›†æˆæµ‹è¯•
pytest test_integration.py -v -m real_files

# å¹¶å‘æµ‹è¯•
pytest test_concurrency.py -v -m real_files

# å·¥å…·æµ‹è¯•
pytest test_utils.py -v -m real_files
```

### 7. è¿è¡Œæ‰€æœ‰çœŸå®æ–‡ä»¶æµ‹è¯•
```bash
pytest -v -m real_files --tb=short
```

## ğŸ“‹ æµ‹è¯•åˆ†ç±»

### 1. APIç«¯ç‚¹æµ‹è¯• (`test_api_endpoints.py`)
æµ‹è¯•æ‰€æœ‰FastAPIç«¯ç‚¹çš„åŠŸèƒ½ï¼š
- âœ… PDFè§£ææ¥å£ (`/v1/parse_pdf_file`)
- âœ… DOCXè§£ææ¥å£ (`/v1/parse_docx_file`)
- âœ… XLSXè§£ææ¥å£ (`/v1/parse_xlsx_file`)
- âœ… HTMLè§£ææ¥å£ (`/v1/parse_html_file`)
- âœ… EPUBè§£ææ¥å£ (`/v1/parse_epub_file`)
- âœ… PPTè§£ææ¥å£ (`/v1/parse_ppt_file`)
- âœ… PPTXè§£ææ¥å£ (`/v1/parse_pptx_file`)
- âœ… DOCè§£ææ¥å£ (`/v1/parse_doc_file`)
- âœ… æ–‡ä»¶ä¸Šä¼ éªŒè¯
- âœ… é”™è¯¯å¤„ç†

### 2. é›†æˆæµ‹è¯• (`test_integration.py`)
æµ‹è¯•ç«¯åˆ°ç«¯å·¥ä½œæµï¼š
- âœ… å®Œæ•´PDFå¤„ç†å·¥ä½œæµ
- âœ… æ‰¹é‡å¤„ç†å·¥ä½œæµ
- âœ… å¹¶å‘å¤„ç†å™¨å·¥ä½œæµ
- âœ… æ··åˆæ–‡ä»¶ç±»å‹é›†æˆ
- âœ… é”™è¯¯æ¢å¤é›†æˆ
- âœ… å¤§è§„æ¨¡é›†æˆå¤„ç†
- âœ… å†…å­˜æ•ˆç‡é›†æˆ

### 3. å¹¶å‘æµ‹è¯• (`test_concurrency.py`)
æµ‹è¯•ç³»ç»Ÿå¹¶å‘å¤„ç†èƒ½åŠ›ï¼š
- âœ… å¹¶å‘PDFè§£æ
- âœ… ä¿¡å·é‡æ§åˆ¶çš„å¹¶å‘å¤„ç†
- âœ… æ‰¹é‡å¤„ç†æ€§èƒ½
- âœ… æ··åˆæ–‡ä»¶ç±»å‹å¹¶å‘
- âœ… å‹åŠ›æµ‹è¯•
- âœ… å†…å­˜ä½¿ç”¨ç›‘æ§
- âœ… é”™è¯¯å¤„ç†

### 4. å·¥å…·æµ‹è¯• (`test_utils.py`)
æµ‹è¯•å·¥å…·å‡½æ•°ï¼š
- âœ… æ–‡ä»¶å¤§å°è®¡ç®—
- âœ… æ–‡ä»¶æ‰©å±•åè·å–
- âœ… æ–‡ä»¶ç±»å‹éªŒè¯
- âœ… è¾“å‡ºç›®å½•åˆ›å»º
- âœ… æ–‡ä»¶ç³»ç»Ÿæ‰«æ
- âœ… å‚æ•°é€‚é…å™¨
- âœ… æ—¥å¿—é…ç½®

## ğŸ·ï¸ æµ‹è¯•æ ‡è®°

### ä¸»è¦æ ‡è®°
- `@pytest.mark.real_files`: æ ‡è®°ä½¿ç”¨çœŸå®æ–‡ä»¶çš„æµ‹è¯•
- `@pytest.mark.integration`: æ ‡è®°é›†æˆæµ‹è¯•
- `@pytest.mark.api`: æ ‡è®°APIæ¥å£æµ‹è¯•

### è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
```bash
# åªè¿è¡ŒçœŸå®æ–‡ä»¶æµ‹è¯•
pytest -m real_files

# åªè¿è¡Œé›†æˆæµ‹è¯•
pytest -m integration

# åªè¿è¡ŒAPIæµ‹è¯•
pytest -m api

# ç»„åˆæ ‡è®°
pytest -m "real_files and integration"
```

## ğŸ”§ æµ‹è¯•é…ç½®

### pytest.ini
```ini
[tool:pytest]
markers =
    real_files: æ ‡è®°éœ€è¦çœŸå®æ–‡ä»¶çš„æµ‹è¯•
    integration: æ ‡è®°é›†æˆæµ‹è¯•
    api: æ ‡è®°APIæ¥å£æµ‹è¯•
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
```

### conftest.py
æä¾›é€šç”¨æµ‹è¯•fixturesï¼š
- `client`: FastAPIæµ‹è¯•å®¢æˆ·ç«¯
- `temp_dir`: ä¸´æ—¶ç›®å½•
- `test_docs_dir`: æµ‹è¯•æ–‡æ¡£ç›®å½•
- `real_test_files`: çœŸå®æµ‹è¯•æ–‡ä»¶è·¯å¾„å­—å…¸

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹

### æˆåŠŸè¿è¡Œ
```
ğŸš€ å¯åŠ¨å®Œæ•´Markioæµ‹è¯•å¥—ä»¶
==================================================
ğŸ“ æµ‹è¯•æ–‡æ¡£ç›®å½•åŒ…å« 10 ä¸ªæ–‡ä»¶:
   1. test_ppt.ppt (7.7 MB)
   2. test_pdf3.pdf (0.0 MB)
   3. test_xlsx.xlsx (0.0 MB)
   4. test_pptx.pptx (4.7 MB)
   5. test_doc.doc (0.3 MB)
   6. test_docx.docx (0.1 MB)
   7. test_pdf1.pdf (9.8 MB)
   8. test_html.html (5.6 MB)
   9. test_epub.epub (0.7 MB)
  10. test_pdf2.pdf (1.3 MB)

==================================================
ğŸ” è¿è¡ŒAPIç«¯ç‚¹æµ‹è¯•...
âœ… APIç«¯ç‚¹æµ‹è¯•é€šè¿‡

ğŸ” è¿è¡Œé›†æˆæµ‹è¯•...
âœ… é›†æˆæµ‹è¯•é€šè¿‡

ğŸ” è¿è¡Œå¹¶å‘æµ‹è¯•...
âœ… å¹¶å‘æµ‹è¯•é€šè¿‡

ğŸ” è¿è¡Œå·¥å…·æµ‹è¯•...
âœ… å·¥å…·æµ‹è¯•é€šè¿‡

==================================================
ğŸ“Š æµ‹è¯•ç»“æœæ‘˜è¦:
==================================================
APIç«¯ç‚¹æµ‹è¯•: âœ… é€šè¿‡
é›†æˆæµ‹è¯•: âœ… é€šè¿‡
å¹¶å‘æµ‹è¯•: âœ… é€šè¿‡
å·¥å…·æµ‹è¯•: âœ… é€šè¿‡
æ‰€æœ‰çœŸå®æ–‡ä»¶æµ‹è¯•: âœ… é€šè¿‡

æ€»è®¡: 5/5 ä¸ªæµ‹è¯•ç±»åˆ«é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•ç±»åˆ«éƒ½é€šè¿‡äº†ï¼
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æµ‹è¯•æ–‡ä»¶ä¸å­˜åœ¨
```
âŒ é”™è¯¯: æµ‹è¯•æ–‡æ¡£ç›®å½•ä¸å­˜åœ¨
   æœŸæœ›è·¯å¾„: /path/to/tests/test_docs
```
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿`tests/test_docs/`ç›®å½•å­˜åœ¨å¹¶åŒ…å«æµ‹è¯•æ–‡ä»¶

#### 2. ä¾èµ–ç¼ºå¤±
```
âŒ Pytestæœªå®‰è£…
```
**è§£å†³æ–¹æ¡ˆ**: å®‰è£…pytest
```bash
pip install pytest
```

#### 3. æµ‹è¯•è·³è¿‡
```
test_pdf_parse_endpoint ... SKIPPED: æµ‹è¯•PDFæ–‡ä»¶ä¸å­˜åœ¨: /path/to/test_pdf1.pdf
```
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥æµ‹è¯•æ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼Œç¡®ä¿æ‰€æœ‰å¼•ç”¨çš„æ–‡ä»¶éƒ½å­˜åœ¨

### è°ƒè¯•æ¨¡å¼
```bash
# è¯¦ç»†è¾“å‡º
pytest -v -s -m real_files

# æ˜¾ç¤ºè·³è¿‡åŸå› 
pytest -rs -m real_files

# æ˜¾ç¤ºæœ€æ…¢çš„æµ‹è¯•
pytest --durations=10 -m real_files
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### æµ‹è¯•æ‰§è¡Œæ—¶é—´
- **APIç«¯ç‚¹æµ‹è¯•**: é€šå¸¸ < 30ç§’
- **é›†æˆæµ‹è¯•**: é€šå¸¸ < 2åˆ†é’Ÿ
- **å¹¶å‘æµ‹è¯•**: é€šå¸¸ < 3åˆ†é’Ÿ
- **å·¥å…·æµ‹è¯•**: é€šå¸¸ < 10ç§’

### å†…å­˜ä½¿ç”¨
- æµ‹è¯•è¿‡ç¨‹ä¸­ä¼šç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- å¤§æ–‡ä»¶æµ‹è¯•ä¼šç‰¹åˆ«å…³æ³¨å†…å­˜æ•ˆç‡
- å¹¶å‘æµ‹è¯•ä¼šéªŒè¯å†…å­˜ç®¡ç†

## ğŸ”„ æŒç»­é›†æˆ

### GitHub Actions
```yaml
- name: Run Tests
  run: |
    cd tests
    python run_tests.py --full
```

### æœ¬åœ°å¼€å‘
```bash
# å¼€å‘æ—¶å¿«é€Ÿæµ‹è¯•
pytest test_api_endpoints.py::TestAPIEndpoints::test_pdf_parse_endpoint -v

# å®Œæ•´æµ‹è¯•å¥—ä»¶
python run_tests.py --full

# å¿«é€Ÿæ¼”ç¤º
python run_tests.py --demo

# ç¯å¢ƒæ£€æŸ¥
python run_tests.py --check
```

## ğŸ“ æ·»åŠ æ–°æµ‹è¯•

### 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
```python
@pytest.mark.real_files
def test_new_feature(self, real_test_files):
    """æµ‹è¯•æ–°åŠŸèƒ½ - ä½¿ç”¨çœŸå®æ–‡ä»¶"""
    # ä½¿ç”¨çœŸå®æµ‹è¯•æ–‡ä»¶
    test_file = real_test_files["pdf"]
    # ... æµ‹è¯•é€»è¾‘
```

### 2. æ·»åŠ æµ‹è¯•æ ‡è®°
åœ¨`conftest.py`ä¸­æ·»åŠ æ–°æ ‡è®°ï¼š
```python
if any(test_name in item.name for test_name in [
    # ... ç°æœ‰æµ‹è¯•
    "test_new_feature"
]):
    item.add_marker(pytest.mark.real_files)
```

### 3. æ›´æ–°README
åœ¨ç›¸åº”çš„æµ‹è¯•åˆ†ç±»ä¸­æ·»åŠ æ–°æµ‹è¯•çš„æè¿°ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. **æµ‹è¯•è¦†ç›–**: æ–°åŠŸèƒ½å¿…é¡»åŒ…å«ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
2. **çœŸå®æ–‡ä»¶**: ä¼˜å…ˆä½¿ç”¨çœŸå®æ–‡æ¡£æ–‡ä»¶è€Œémockæ•°æ®
3. **é”™è¯¯å¤„ç†**: æµ‹è¯•åº”è¯¥åŒ…å«æ­£å¸¸æƒ…å†µå’Œå¼‚å¸¸æƒ…å†µ
4. **æ€§èƒ½è€ƒè™‘**: å¤§æ–‡ä»¶æµ‹è¯•åº”è¯¥è€ƒè™‘æ‰§è¡Œæ—¶é—´
5. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°READMEå’Œæµ‹è¯•è¯´æ˜

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°æµ‹è¯•é—®é¢˜ï¼š
1. æ£€æŸ¥æµ‹è¯•ç¯å¢ƒé…ç½®
2. éªŒè¯æµ‹è¯•æ–‡ä»¶å®Œæ•´æ€§
3. æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
4. æäº¤issueæè¿°é—®é¢˜

---

## ğŸ§¹ æ¸…ç†è¯´æ˜

**å·²åˆ é™¤çš„å†—ä½™æ–‡ä»¶ï¼š**
- âŒ `quick_test.py` - æ—§çš„å¿«é€Ÿæµ‹è¯•è„šæœ¬
- âŒ `run_improved_tests.py` - æ—§çš„æ”¹è¿›æµ‹è¯•è„šæœ¬
- âŒ `quick_demo.py` - æ—§çš„æ¼”ç¤ºè„šæœ¬

**åˆå¹¶åçš„ç»Ÿä¸€è„šæœ¬ï¼š**
- âœ… `run_tests.py` - ç»Ÿä¸€çš„æµ‹è¯•è¿è¡Œè„šæœ¬ï¼Œæ”¯æŒå¤šç§æ¨¡å¼ï¼š
  - `--full`: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
  - `--demo`: è¿è¡Œå¿«é€Ÿæ¼”ç¤º
  - `--check`: åªæ£€æŸ¥ç¯å¢ƒ
  - é»˜è®¤: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

**ä¿ç•™çš„æ ¸å¿ƒæ–‡ä»¶ï¼š**
- âœ… æ‰€æœ‰æ”¹è¿›åçš„æµ‹è¯•æ–‡ä»¶ï¼ˆä½¿ç”¨çœŸå®æ–‡æ¡£æ–‡ä»¶ï¼‰
- âœ… å®Œæ•´çš„æµ‹è¯•é…ç½®å’Œfixtures
- âœ… ç»Ÿä¸€çš„æµ‹è¯•è¿è¡Œè„šæœ¬
- âœ… è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜

**æ³¨æ„**: è¿™äº›æµ‹è¯•ä½¿ç”¨çœŸå®çš„æ–‡æ¡£æ–‡ä»¶ï¼Œç¡®ä¿åœ¨è¿è¡Œå‰æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å’Œå†…å­˜ã€‚
